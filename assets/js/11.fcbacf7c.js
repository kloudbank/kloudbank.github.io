(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{668:function(t,s,a){t.exports=a.p+"assets/img/jhub-profile-official.75767e45.png"},669:function(t,s,a){t.exports=a.p+"assets/img/jupyter-hub-admin-panel.05303e0c.png"},670:function(t,s,a){t.exports=a.p+"assets/img/keycloak-client-jupyterhub.533eefd4.png"},671:function(t,s,a){t.exports=a.p+"assets/img/github-oauthapp-keycloak.f0f1678b.png"},672:function(t,s,a){t.exports=a.p+"assets/img/keycloak-provider-github.c8a8dde2.png"},673:function(t,s,a){t.exports=a.p+"assets/img/github-oauth-callback.37bbf7c1.png"},674:function(t,s,a){t.exports=a.p+"assets/img/keycloak-jhub-login.73b8cc12.png"},675:function(t,s,a){t.exports=a.p+"assets/img/github-keycloak-login.a2d6243a.png"},761:function(t,s,a){"use strict";a.r(s);var e=a(15),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"introduction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),e("p",[t._v("Jupyter Hub 는 multi user 에게 Jupyter Notebook 을 제공하는 좋은 방안이다. 또한, 단일 사용자 Jupyter Notebook 의 다수의 인스턴스를 생성 및 관리할 수 있으며, Proxy 처리까지 담당하는 Multi-User Hub 이다.")]),t._v(" "),e("ul",[e("li",[t._v("크게 4개의 subsystem 으로 구성.\n"),e("ul",[e("li",[t._v("사용자 환경 UI 제공 및 subsystem 간 연계를 위한 Hub.")]),t._v(" "),e("li",[t._v("Client Browser 의 request 처리를 위한 HTTP Proxy.")]),t._v(" "),e("li",[t._v("multiple single-user Jupyter notebook 서버를 관리하는 Spawner.")]),t._v(" "),e("li",[t._v("사용자 제어를 위한 Authentication class.")])])])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://jupyterhub.readthedocs.io/en/stable/_images/jhub-fluxogram.jpeg",width:"600px",height:"450px",title:"hub-arch",alt:"hub-arch"}})]),t._v(" "),e("blockquote",[e("p",[t._v("Jupyter Hub Docs 참조"),e("br"),t._v(" "),e("a",{attrs:{href:"https://jupyterhub.readthedocs.io/en/stable/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://jupyterhub.readthedocs.io/en/stable/index.html"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"jupyter-hub-for-kubernetes-project"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jupyter-hub-for-kubernetes-project"}},[t._v("#")]),t._v(" Jupyter Hub for kubernetes Project")]),t._v(" "),e("p",[t._v("Jupyter Hub for kubernetes Project 는 Cloud / On-premise 의 기존 k8s 환경에서 self managed JupyterHub를 설정하고 대규모 사용자 그룹을 지원하기 위한 Project. 특정 CSP 업체와 관련이 없으며, Helm Chart Version 을 통하여 제공. (k8s ver.> = 1.14 / Helm >= 2.16)")]),t._v(" "),e("ul",[e("li",[t._v("Architecture\n"),e("ul",[e("li",[t._v("Proxy, Hub 등의 사용자 request 처리를 위한 서비스 동일")]),t._v(" "),e("li",[t._v("관리자 지정 Docker Image 를 가져오기 위한 Puller 및 Resource 관리를 위한 Idle Culler 내장")])])])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://zero-to-jupyterhub.readthedocs.io/en/stable/_images/architecture.png",title:"hub-k8s-arch",alt:"hub-k8s-arch"}})]),t._v(" "),e("ul",[e("li",[t._v("주요 특징\n"),e("ul",[e("li",[t._v("helm 배포시 사용되는 config.yml 파일을 수정하여 hub, singleuser, proxy 등 설정")]),t._v(" "),e("li",[t._v("nbgitpuller 를 사용하여 git 과 동기화 가능")]),t._v(" "),e("li",[t._v("일반적으로 사용자가 직접 conda kernel 을 구성")]),t._v(" "),e("li",[t._v("profileList 를 정의하여 docker image, gpu, volume 등 별도 환경 구성")]),t._v(" "),e("li",[t._v("사용자 로그인 및 server 시작시 profileList 중에서 1개를 선택 가능하며, 사용자별 Notebook Server 하나만 생성 가능")]),t._v(" "),e("li",[t._v("사용자 ID 로 Notebook Server Pod 생성")])])])]),t._v(" "),e("blockquote",[e("p",[t._v("Jupyter Hub for kubernetes Docs 참조"),e("br"),t._v(" "),e("a",{attrs:{href:"https://zero-to-jupyterhub.readthedocs.io/en/stable/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://zero-to-jupyterhub.readthedocs.io/en/stable/index.html"),e("OutboundLink")],1)])]),t._v(" "),e("blockquote",[e("p",[t._v("Jupyter Hub KubeSpawner Docs 참조"),e("br"),t._v(" "),e("a",{attrs:{href:"https://jupyterhub-kubespawner.readthedocs.io/en/latest/spawner.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://jupyterhub-kubespawner.readthedocs.io/en/latest/spawner.html"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"setup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup"}},[t._v("#")]),t._v(" Setup")]),t._v(" "),e("ul",[e("li",[t._v("helm install 및 upgrade 를 통하여, Jupyter Hub for kubernetes 관리")]),t._v(" "),e("li",[t._v("Environment\n"),e("ul",[e("li",[t._v("k8s v1.19.7")]),t._v(" "),e("li",[t._v("helm v3.5.2")]),t._v(" "),e("li",[t._v("jupyter hub v0.11.1")])])])]),t._v(" "),e("blockquote",[e("p",[t._v("Install Jupyter Hub 참조"),e("br"),t._v(" "),e("a",{attrs:{href:"https://zero-to-jupyterhub.readthedocs.io/en/stable/jupyterhub/installation.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://zero-to-jupyterhub.readthedocs.io/en/stable/jupyterhub/installation.html"),e("OutboundLink")],1)])]),t._v(" "),e("ul",[e("li",[t._v("helm upgrade\n"),e("ul",[e("li",[t._v("hub, proxy pod Restart. (strategy type: Recreate, 1분 내로 restart 됨)")]),t._v(" "),e("li",[t._v("신규 사용자 로그인 불가")]),t._v(" "),e("li",[t._v("기존 사용자 로그인 불가")]),t._v(" "),e("li",[t._v("기존 사용자 신규 notebook 파일 생성 불가")]),t._v(" "),e("li",[e("u",[e("em",[t._v("기존 사용자 개발중인 notebook 파일에서 개발 작업은 가능")])])])])])]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("helm upgrade --cleanup-on-fail "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--install "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$RELEASE")]),t._v(" jupyterhub/jupyterhub "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--namespace "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAMESPACE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--create-namespace "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--version"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.11")]),t._v(".1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--values config.yaml\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("ul",[e("li",[t._v("배포 내역")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ kubectl get deploy\n\nNAME             READY   UP-TO-DATE   AVAILABLE   AGE\nhub              1/1     1            1           11d\nproxy            1/1     1            1           11d\nuser-scheduler   2/2     2            2           11d\n\n$ kubectl get ds\nNAME                      DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\ncontinuous-image-puller   2         2         2       2            2           <none>          11d\n\n$ kubectl get svc\n\nNAME                      TYPE           CLUSTER-IP       EXTERNAL-IP          PORT(S)                      AGE\nhub                       ClusterIP      10.100.224.155   <none>               8081/TCP                     11d\nproxy-api                 ClusterIP      10.100.61.200    <none>               8001/TCP                     11d\nproxy-public              LoadBalancer   10.100.234.106   <EXTERNAL-IP>        443:31151/TCP,80:30780/TCP   11d\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br")])]),e("h3",{attrs:{id:"hub-with-notebook-official-image"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hub-with-notebook-official-image"}},[t._v("#")]),t._v(" Hub with Notebook Official Image")]),t._v(" "),e("p",[t._v("config.yaml 의 singleuser configuration 을 활용하여, Jupyter Notebook Official Image 기반 기본 Profile 생성")]),t._v(" "),e("ul",[e("li",[t._v("Jupyter Notebook Official Image Dockerfile 기본 설명\n"),e("ul",[e("li",[t._v("ubuntu base image 기반, conda 및 python 개발 환경 설치")]),t._v(" "),e("li",[t._v("jovyan user 의 home directory 에 작업 환경 구축")]),t._v(" "),e("li",[t._v("notebook, jupyterhub, jupyterlab 을 기본적으로 설치")]),t._v(" "),e("li",[t._v("Image 에 포함되어 있는 별도의 shell script 를 실행하여, container 구동")])])])]),t._v(" "),e("div",{staticClass:"language-Dockerfile line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[e("code",[t._v("...\n\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" conda install --quiet --yes "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'notebook=6.3.0'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jupyterhub=1.3.0'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jupyterlab=3.0.14'")]),t._v(" && "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    conda clean --all -f -y && "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    npm cache clean --force && "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    jupyter notebook --generate-config && "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    jupyter lab clean && "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    rm -rf /home/"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NB_USER")]),t._v("/.cache/yarn && "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    fix-permissions "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$CONDA_DIR")]),t._v(" && "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    fix-permissions /home/"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NB_USER")])]),t._v("\n\n...\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br")])]),e("ul",[e("li",[t._v("config.yaml 구성\n"),e("ul",[e("li",[t._v("singleuser 에서 default image 설정")]),t._v(" "),e("li",[t._v("profileList 를 통하여, profile 별 관리자 지정 image 설정 가능")]),t._v(" "),e("li",[t._v("kubespawner 에서 k8s 설정을 override 하여, image / resource / volume 등을 별도 관리")])])])]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singleuser")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jupyter/minimal"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tag")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" latest\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" none\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("guarantee")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.05")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1G\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("guarantee")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 256M\n\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("profileList")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("display_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Minimal environment"')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Default env."')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("display_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Data Science environment"')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Data Science env."')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubespawner_override")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Data Science 를 위한 Official Image")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jupyter/datascience"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Resources")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu_limit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu_guarantee")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.05")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mem_limit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 2G\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mem_guarantee")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 256M\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Volumes")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volume_mounts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jupyter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tf\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /home/jovyan\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jupyter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tf\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeClaim")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("claimName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jupyter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tf\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br"),e("span",{staticClass:"line-number"},[t._v("23")]),e("br"),e("span",{staticClass:"line-number"},[t._v("24")]),e("br"),e("span",{staticClass:"line-number"},[t._v("25")]),e("br"),e("span",{staticClass:"line-number"},[t._v("26")]),e("br"),e("span",{staticClass:"line-number"},[t._v("27")]),e("br"),e("span",{staticClass:"line-number"},[t._v("28")]),e("br"),e("span",{staticClass:"line-number"},[t._v("29")]),e("br"),e("span",{staticClass:"line-number"},[t._v("30")]),e("br"),e("span",{staticClass:"line-number"},[t._v("31")]),e("br"),e("span",{staticClass:"line-number"},[t._v("32")]),e("br"),e("span",{staticClass:"line-number"},[t._v("33")]),e("br"),e("span",{staticClass:"line-number"},[t._v("34")]),e("br"),e("span",{staticClass:"line-number"},[t._v("35")]),e("br")])]),e("ul",[e("li",[t._v("Jupyter Hub Profile List 조회"),e("br"),t._v(" "),e("img",{attrs:{src:a(668),alt:""}})])]),t._v(" "),e("h3",{attrs:{id:"hub-with-notebook-custom-image"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hub-with-notebook-custom-image"}},[t._v("#")]),t._v(" Hub with Notebook Custom Image")]),t._v(" "),e("p",[t._v("Official Image 가 아닌, 사용자가 직접 정의한 Dockerfile 및 command script 등으로 Custom Notebook Image 구성이 되어 있는 경우, Jupyter Hub 에서 구동하기 위해 확인해야 할 항목.")]),t._v(" "),e("ol",[e("li",[t._v("jupyterhub package 설치\n"),e("ul",[e("li",[t._v("JupyterHub 의 Notebook Server Pod 생성 시, Notebook Image 에 설치된 "),e("b",[t._v("jupyterhub-singleuser")]),t._v(" command 를 통하여 실행.")]),t._v(" "),e("li",[t._v("Official Image 에는 jupyterhub package 가 내장되어 있어, 별도의 설정 변경 없이 Jupyter Hub 에서 Notebook 실행 가능.")]),t._v(" "),e("li",[e("em",[t._v("jupyterhub-singleuser 는 jupyterhub package 설치를 통하여 실행 가능하므로, custom image 에 jupyterhub package 설치 필요.")])])])])]),t._v(" "),e("ul",[e("li",[t._v("Custom Notebook Image Dockerfile\n"),e("ul",[e("li",[e("p",[t._v("ubuntu base image 기반으로, python3 설치 및 jupyter notebook / lab 이 설치되어 있다고 가정.")])]),t._v(" "),e("li",[e("p",[e("u",[e("em",[t._v("Dockerfile 혹은, k8s cmd script 에서 jupyterhub package 설치 추가.")])])])]),t._v(" "),e("li",[e("p",[t._v("Dockerfile")])])])])]),t._v(" "),e("div",{staticClass:"language-Dockerfile line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" ubuntu:18.04")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USER")]),t._v(" root")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" apt-get update")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" apt-get install -y python3 python3-pip openjdk-8-jre wget")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ln -s /usr/bin/python3 /usr/bin/python")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ln -s /usr/bin/pip3 /usr/bin/pip")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" python -m pip install --upgrade pip")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" python -m pip install notebook -U && pip install jupyterlab")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" jupyter notebook --generate-config --allow-root -y")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" run.sh /usr/local/bin/")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 8888")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /root")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br")])]),e("ul",[e("li",[t._v("command run.sh")])]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("python -m pip "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" jupyterhub\njupyter notebook --allow-root --ip"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0 --NotebookApp.token"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(" --notebook-dir"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/root\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" infinity\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("기존에 root 권한으로 Notebook 실행 시\n"),e("ul",[e("li",[t._v("Official Image 의 경우, jovyan 이라는 공통 user 를 생성하여 Notebook Server 를 구동하며, jupyterhub-singleuser command 실행 시에도 별도의 옵션 지정이 필요 없음.")]),t._v(" "),e("li",[t._v("uid / gid 설정을 통하여, securityContext 설정 변경.")]),t._v(" "),e("li",[e("em",[t._v("Custom Image 의 경우, root 로 그대로 실행하기 위해서는, "),e("b",[t._v("--allow-root")]),t._v(" option 을 kubespawner_override cmd 에 설정해주어야 함.")])])])])]),t._v(" "),e("ul",[e("li",[t._v("config.yaml\n"),e("ul",[e("li",[t._v("kubespawner_override 수정")])])])]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("display_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Custom Notebook without conda"')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"without conda"')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubespawner_override")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu_limit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu_guarantee")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mem_limit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 2G\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mem_guarantee")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 512M\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# root 권한 실행을 위한 override 설정 추가")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uid")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gid")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cmd")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jupyterhub-singleuser"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--allow-root"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--ip=0.0.0.0"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" htdp1/jupyter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("custom"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image_pull_policy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Always\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volume_mounts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jupyter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tf\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /root\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jupyter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tf\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeClaim")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("claimName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jupyter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tf\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br"),e("span",{staticClass:"line-number"},[t._v("23")]),e("br"),e("span",{staticClass:"line-number"},[t._v("24")]),e("br")])]),e("h2",{attrs:{id:"customization"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#customization"}},[t._v("#")]),t._v(" Customization")]),t._v(" "),e("p",[t._v("Migration 시 필요한 Customization 확인.")]),t._v(" "),e("p",[t._v("기존에 사용하던 Notebook 혹은 Lab 개발 Container 환경을, Jupyter Hub 에서 동일하게 사용하기 위해 확인할 항목."),e("br"),t._v("\n기존의 Container 환경은 Docker commit 을 통하여 Image 를 생성하고, 이를 Jupyter Hub 에서 구동한다고 가정.")]),t._v(" "),e("h3",{attrs:{id:"docker-commit-image-구동"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-commit-image-구동"}},[t._v("#")]),t._v(" Docker Commit Image 구동")]),t._v(" "),e("ul",[e("li",[t._v("작업 순서\n"),e("ol",[e("li",[t._v("Custom Image 로 Kubernetes 에 배포된 Notebook 개발 환경 생성")]),t._v(" "),e("li",[t._v("Container 가 구동 중인 Worker Node 에 접속")]),t._v(" "),e("li",[t._v("해당 Container ID 를 찾아서 docker commit")]),t._v(" "),e("li",[t._v("docker registry 에 push 하여, Migration Image 완성")])])])]),t._v(" "),e("blockquote",[e("p",[t._v("Kubernetes 에 구동 되는 Pod 의 Docker commit 참조"),e("br"),t._v(" "),e("a",{attrs:{href:"https://stackoverflow.com/questions/49481849/is-there-a-way-to-download-the-container-image-from-a-pod-in-kuberentes-environm",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://stackoverflow.com/questions/49481849/is-there-a-way-to-download-the-container-image-from-a-pod-in-kuberentes-environm"),e("OutboundLink")],1)])]),t._v(" "),e("h4",{attrs:{id:"entrypoint-초기화"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint-초기화"}},[t._v("#")]),t._v(" ENTRYPOINT 초기화")]),t._v(" "),e("ul",[e("li",[t._v("Jupyter Hub 는 Notebook Server Pod 생성 시, 아래의 args 에 정의된 명령어를 실행하여 생성하며, 기본적으로 ip 허용 / port 지정 옵션만 추가되어 있음.")])]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[t._v("    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Args")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      jupyterhub"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("singleuser\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip=0.0.0.0\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port=8888\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("ul",[e("li",[t._v("기존에 k8s deployment 에, command 에 초기 실행 script 가 정의되어 있을 경우, 해당 script 가 실행되어 jupyterhub-singleuser notebook server 생성이 불가능.")])]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[t._v("    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" htdp1/jupyter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("custom"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jupyter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("custom\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Always\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 초기 실행 script")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/sh"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-c"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"run.sh"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br")])]),e("ul",[e("li",[e("u",[e("em",[t._v("Docker Commit 시, ENTRYPOINT 초기화 하거나, run.sh 에서 jupyterhub-singleuser 를 실행하도록 script 수정 필요")])])])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ docker commit --change='ENTRYPOINT [\"\"]' <container-id> jupyter-notebook-custom\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"jupyter-lab-호환"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jupyter-lab-호환"}},[t._v("#")]),t._v(" Jupyter Lab 호환")]),t._v(" "),e("h4",{attrs:{id:"jupyter-lab"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jupyter-lab"}},[t._v("#")]),t._v(" Jupyter Lab")]),t._v(" "),e("p",[t._v("Jupyter Lab 은 Project Jupyter 를 위한 차세대 웹 기반 사용자 인터페이스이다. Jupyter Lab을 활용하여, 유연하고 통합되며 확장 가능한 방식으로 Jupyter Notebook , Text Editor, Terminal 등을 활용할 수 있다.")]),t._v(" "),e("blockquote",[e("p",[t._v("Jupyter Lab Docs 참조"),e("br"),t._v(" "),e("a",{attrs:{href:"https://jupyterlab.readthedocs.io/en/latest/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://jupyterlab.readthedocs.io/en/latest/index.html"),e("OutboundLink")],1)])]),t._v(" "),e("h4",{attrs:{id:"호환성"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#호환성"}},[t._v("#")]),t._v(" 호환성")]),t._v(" "),e("ul",[e("li",[t._v("Jupyter Hub 에서 Lab 구동\n"),e("ul",[e("li",[t._v("기본적으로 Jupyter Notebook Official Image 에 jupyterlab package 가 설치되어 있으므로, 해당 base image 기반으로 구동시 Notebook 과 Lab 의 인터페이스를 모두 사용 가능.")]),t._v(" "),e("li",[t._v("Custom Notebook Image 에도 jupyterlab package 를 설치하여 구동하면, Jupyter Lab 인터페이스 사용 가능.")]),t._v(" "),e("li",[t._v("URL context 로 인터페이스 변경\n"),e("ul",[e("li",[t._v("domain:port/tree")]),t._v(" "),e("li",[t._v("domain:port/lab")])])]),t._v(" "),e("li",[t._v("spanwner_override 를 활용하여, profile 별 default_url 을 변경하여 초기 실행 인터페이스 별도 설정 가능.")]),t._v(" "),e("li",[t._v("Migration 시 확인할 항목은 Jupyter Notebook 과 동일함.")])])])]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[t._v("    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("display_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bonjour Lab"')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bonjour tensorflow."')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubespawner_override")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu_limit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu_guarantee")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Jupyter Lab 을 초기 실행 화면으로,,,")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default_url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /lab\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mem_limit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4G\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mem_guarantee")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 512M\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" htdp1/jupyter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notebook"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("bonjour\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br")])]),e("h2",{attrs:{id:"idle-culler"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#idle-culler"}},[t._v("#")]),t._v(" Idle Culler")]),t._v(" "),e("p",[t._v("Jupyter Hub 는 jupyterhub-idle-culler 서비스를 활용하여, 유휴 또는 장기 실행 Jupyter Notebook Server 를 식별하고 종료함."),e("br"),t._v("\nJupyter Hub API token 인증을 통하여, Python Standalone script 로 실행하여 jupyterhub-idle-culler 실행도 가능.")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("JUPYTERHUB_API_TOKEN")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("jupyterhub token"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\npython3 -m jupyterhub-idle-culler "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("--timeout"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("900")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("--url"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://localhost:8081/hub/api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("blockquote",[e("p",[t._v("Jupyter Hub Idel Culler Github Repository 참조"),e("br"),t._v(" "),e("a",{attrs:{href:"https://github.com/jupyterhub/jupyterhub-idle-culler",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/jupyterhub/jupyterhub-idle-culler"),e("OutboundLink")],1)])]),t._v(" "),e("h4",{attrs:{id:"주요-특징"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#주요-특징"}},[t._v("#")]),t._v(" 주요 특징")]),t._v(" "),e("ul",[e("li",[t._v("timeout 설정 시간 동안, 활동이 없는 사용자 pod 자동 삭제 가능.")]),t._v(" "),e("li",[t._v("Jupyter Hub browser 실행 상태로 두면 pod 를 자동으로 삭제하지 않음.")]),t._v(" "),e("li",[t._v("다시 시작하면 변수 등 환경정보 손실, pip install 로 설치된 패키지 손실, 전역 설치 패키지 손실")])]),t._v(" "),e("h4",{attrs:{id:"culling-test-result"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#culling-test-result"}},[t._v("#")]),t._v(" Culling Test Result")]),t._v(" "),e("ul",[e("li",[t._v("cull: timeout: 120, every: 10 (seconds)")])]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cull")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("every")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("ul",[e("li",[t._v("notebook 화면을 띄운 상태에서는 pod 가 유지됨")]),t._v(" "),e("li",[t._v("notebook 화면에 포커스가 없어도 pod 가 유지됨")]),t._v(" "),e("li",[t._v("notebook 화면을 닫아서 완전히 벗어나야 pod 가 kill 됨")])]),t._v(" "),e("h2",{attrs:{id:"authentication"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authentication"}},[t._v("#")]),t._v(" Authentication")]),t._v(" "),e("h3",{attrs:{id:"basic-authenticator"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#basic-authenticator"}},[t._v("#")]),t._v(" Basic Authenticator")]),t._v(" "),e("p",[t._v("Jupyter Hub 기본 Authenticator 를 활용하여, 사용자 추가/삭제 및 admin, whitelist user 관리할 수 있다.")]),t._v(" "),e("p",[t._v("Jupyter Hub에는 특별한 권한을 가진 Admin 개념이 존재한다. 다른 사용자의 server 를 start/stop 하는 권한이 있으며, 선택적으로 사용자의 Notebook Server 에 access 할 수 있다. Control Panel 에 admin 버튼 이 표시되며, 이러한 모든 작업을 수행 할 수 있는 Admin Panel 에 접근할 수 있다.")]),t._v(" "),e("p",[t._v("| "),e("u",[e("em",[t._v("User 정보 관리, admin / whitelist 관리 외에, user 별 password 설정 혹은 기타 인증 설정은 불가")])])]),t._v(" "),e("ul",[e("li",[t._v("Jupyter Hub Admin Panel")])]),t._v(" "),e("p",[e("img",{attrs:{src:a(669),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"authenticator-use-case"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authenticator-use-case"}},[t._v("#")]),t._v(" Authenticator Use Case")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("None (설정 없음)")]),t._v(" "),e("ul",[e("li",[t._v("임의의 id 입력해도 login 가능 하며, 해당 id 로 hub user 생성됨.")])])]),t._v(" "),e("li",[e("p",[t._v("admin user 설정 시")]),t._v(" "),e("ul",[e("li",[t._v("admin_users 에 등록된 id 로 login 할 때만, Admin Panel 접근 가능")]),t._v(" "),e("li",[t._v("admin 은 user 추가/수정/삭제, user server 접속/시작/중지 가능")]),t._v(" "),e("li",[t._v("일반 user 는 임의의 id 입력하여 login 가능")])])]),t._v(" "),e("li",[e("p",[t._v("whitelist user 설정 시")]),t._v(" "),e("ul",[e("li",[t._v("allowed_users 에 등록된 id 만 login 가능")]),t._v(" "),e("li",[t._v('admin 은 Admin Panel 에서 "Add Users" 기능을 이용하여, whitelist user 추가 가능')])])]),t._v(" "),e("li",[e("p",[t._v("Data Repository")]),t._v(" "),e("ul",[e("li",[t._v("Jupyter Hub 별 mount 한 volume 에 data 가 저장되며, helm chart 를 uninstall 할 때 삭제됨.")]),t._v(" "),e("li",[t._v("sqlite 로 data 관리하는 것이 default 설정임.")])])]),t._v(" "),e("li",[e("p",[t._v("Rest API")]),t._v(" "),e("ul",[e("li",[t._v("Jupyter Hub 별로, user/server 정보 관리를 위한 API 제공")]),t._v(" "),e("li",[t._v("Jupyter Hub 에서 발행한 API token 기반으로 API call 가능"),e("br"),t._v(" "),e("a",{attrs:{href:"https://jupyterhub.readthedocs.io/en/latest/_static/rest-api/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://jupyterhub.readthedocs.io/en/latest/_static/rest-api/index.html"),e("OutboundLink")],1)])])]),t._v(" "),e("li",[e("p",[t._v("User Config Example")])])]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hub")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Authenticator")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin_users")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" admin\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" user1\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" user2\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allowed_users")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" user3\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" user4\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br")])]),e("h3",{attrs:{id:"dummyauthenticator"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dummyauthenticator"}},[t._v("#")]),t._v(" DummyAuthenticator")]),t._v(" "),e("p",[t._v("Jupyter Hub 에서 제공하는 DummyAuthenticator 로, hub 에 대한 전역 password 설정 가능")]),t._v(" "),e("ul",[e("li",[t._v("DummyAuthenticator password config")])]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hub")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Authenticator")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin_users")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" admin\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" user1\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" user2\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allowed_users")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" user3\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" user4\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DummyAuthenticator")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <password"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("JupyterHub")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("authenticator_class")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dummy"')]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br")])]),e("h3",{attrs:{id:"oauthenticator"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#oauthenticator"}},[t._v("#")]),t._v(" OAuthenticator")]),t._v(" "),e("p",[t._v("JupyterHub의 oauthenticator 는 사용자가 GitHub, Google 및 CILogon과 같은 third-party OAuth2 identity provider 를 통해 인증할 수 있도록 지원함. OAuth2 Client ID 와 Secret 이 필요함.")]),t._v(" "),e("blockquote",[e("p",[t._v("Jupyter Hub oauthenticator Docs 참조"),e("br"),t._v(" "),e("a",{attrs:{href:"https://oauthenticator.readthedocs.io/en/stable/getting-started.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://oauthenticator.readthedocs.io/en/stable/getting-started.html"),e("OutboundLink")],1)])]),t._v(" "),e("h4",{attrs:{id:"genericoauthenticator-class-를-활용한-keycloak-server-인증-test"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#genericoauthenticator-class-를-활용한-keycloak-server-인증-test"}},[t._v("#")]),t._v(" GenericOAuthenticator class 를 활용한, KeyCloak Server 인증 Test")]),t._v(" "),e("p",[e("em",[t._v("Key Cloak 의 경우, OpenID / SAML2.0 모두를 지원하며, sso login 연계 혹은 oauth2 인증 방식의 third-pary 인증 서버 연계 등에 유용하게 사용 가능할 것으로 보임.")])]),t._v(" "),e("blockquote",[e("p",[t._v("KeyCloak 공식 문서 참조"),e("br"),t._v(" "),e("a",{attrs:{href:"https://www.keycloak.org/docs/latest/getting_started/index.html#securing-a-sample-application",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.keycloak.org/docs/latest/getting_started/index.html#securing-a-sample-application"),e("OutboundLink")],1)])]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Environment")]),t._v(" "),e("ul",[e("li",[t._v("k8s v1.19.7")]),t._v(" "),e("li",[t._v("helm v3.5.2")]),t._v(" "),e("li",[t._v("jupyter hub v0.11.1")]),t._v(" "),e("li",[t._v("keycloak v12.0.4")])])]),t._v(" "),e("li",[e("p",[t._v("Test Architecture")])])]),t._v(" "),e("img",{attrs:{src:"https://www.plantuml.com/plantuml/svg/LLB1Ri8m3BtdAonssGx0lKo82I6sCMdJjXz86ujcJUEgTGVLnB_FIGc2I-JOp-yzErbrh5lkQwUwolf6jxg6Wkg6F7g6FtLIaxMp4az0Tr34KBLOiFPxXp3PMdxkyrZSMoxxN7e0xb-Cu2mFyD7IhpNOmXljhNyuurou2BSd8noRtLSamAgBtLVqhtqpi7GdZP-a81fRzDZQulsfvpAe5PgfZGe2qf8KsEcMReV3sf6k8bU5Gn4kYIyLhwmAPBGQc4wAgG4co8cPQZ0sC5lowiBqE3DqyBDbsiMTinwptFMu2D7CwAv4is0ySin21i4zV5E57ZR7eXIZgCOrmtGPvyrWBkTyD78U3QP1I039OGQVE1eA3cz7KGbqwReyGGfWsZUI7uL7K-ULodpmv1mTqAWLUYDVvHy0",alt:"uml diagram"}}),t._v(" "),e("ul",[e("li",[t._v("작업 순서\n"),e("ol",[e("li",[t._v("helm chart 활용하여 KeyCloak server 를 kubernetes cluster 에 배포")])]),t._v(" "),e("blockquote",[e("p",[t._v("codecentric/keycloak github 참조"),e("br"),t._v(" "),e("a",{attrs:{href:"https://github.com/codecentric/helm-charts/tree/master/charts/keycloak",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/codecentric/helm-charts/tree/master/charts/keycloak"),e("OutboundLink")],1)])]),t._v(" "),e("ul",[e("li",[t._v("배포 내역")])])])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ kubectl get all -n keycloak\n\nNAME                        READY   STATUS    RESTARTS\npod/keycloak-0              1/1     Running   0       \npod/keycloak-postgresql-0   1/1     Running   0       \n\nNAME                                   TYPE           CLUSTER-IP      EXTERNAL-IP    PORT(S)\nservice/keycloak-headless              ClusterIP      None            <none>         80/TCP\nservice/keycloak-http                  LoadBalancer   10.100.5.198    <external-ip>  80:30339/TCP,8443:32239/TCP,9990:30459/TCP\nservice/keycloak-postgresql            ClusterIP      10.100.250.11   <none>         5432/TCP\nservice/keycloak-postgresql-headless   ClusterIP      None            <none>         5432/TCP\n\nNAME                                   READY\nstatefulset.apps/keycloak              1/1  \nstatefulset.apps/keycloak-postgresql   1/1  \n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[t._v("Jupyter Hub 전용 KeyCloak Realm / Client 구성"),e("br"),t._v(" "),e("img",{attrs:{src:a(670),alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("Github Organization Oauth Apps 에, keycloak app. 추가"),e("br"),t._v(" "),e("img",{attrs:{src:a(671),alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("위에서 생성한 Client ID/secret 을 활용하여, KeyCloak Identity Provider 에 GitHub 추가"),e("br"),t._v(" "),e("img",{attrs:{src:a(672),alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("Github Organization Oauth Apps, keycloak app. 에 Authorization Callback URL Update"),e("br"),t._v(" "),e("img",{attrs:{src:a(673),alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("Jupyter Hub config.yaml 에 GenericOAuthenticator 설정"),e("br"),t._v("\n: "),e("u",[e("em",[t._v("KeyCloak openid connect")])])])])]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hub")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Authenticator")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("auto_login")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GenericOAuthenticator")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin_users")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" admin\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client_id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <keycloak"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client_secret")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <keycloak"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secret"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# jupyter hub oauth callback")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("oauth_callback_url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//<jupyterhub"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("domain"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/hub/oauth_callback\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 이하 keycloak auth / token / userdata URL")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("authorize_url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//<keycloak"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("domain"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/auth/realms/htdp1/protocol/openid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("connect/auth\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("token_url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//<keycloak"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("domain"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/auth/realms/htdp1/protocol/openid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("connect/token\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("userdata_url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//<keycloak"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("domain"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/auth/realms/htdp1/protocol/openid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("connect/userinfo\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("login_service")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" keycloak\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username_key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" preferred_username\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("userdata_params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" state\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("JupyterHub")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("authenticator_class")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" generic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("oauth\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br")])]),e("h4",{attrs:{id:"test-result-summary"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#test-result-summary"}},[t._v("#")]),t._v(" Test Result Summary")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Jupyter Hub Login 시, KeyCloak Login 으로 redirect")]),t._v(" "),e("ul",[e("li",[t._v("keycloak user 로 login 가능")]),t._v(" "),e("li",[t._v("identity provider 인 GitHub 로 login 가능"),e("br"),t._v(" "),e("img",{attrs:{src:a(674),alt:""}})])])]),t._v(" "),e("li",[e("p",[t._v("KeyCloak 에 Identity Provider 로 등록된 GitHub 를 통한 Login")]),t._v(" "),e("ul",[e("li",[t._v("GitHub Client key 를 생성한 Organization 에 속한 User 만 인가됨."),e("br"),t._v(" "),e("img",{attrs:{src:a(675),alt:""}})])])]),t._v(" "),e("li",[e("p",[t._v("특이 사항"),e("br"),t._v("\n: Jupyter Hub Logout 기능을 사용할 경우, Jupyter Hub session 만 삭제됨."),e("br"),t._v("\n| "),e("u",[e("em",[t._v("Jupyter Hub Logout 시, KeyCloak 혹은 인증된 Identity Provider (SSO / GitHub etc.) session 까지 삭제하는 것은 Optional 영역")])]),t._v("일 것으로 보이며, Jupyter Hub Logout 을 통하여 인증된 모든 session 을 삭제할 경우, 추가 개발이 필요.")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);