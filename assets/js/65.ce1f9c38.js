(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{753:function(s,a,n){"use strict";n.r(a);var t=n(13),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"kubernates-deploy-에-helm-과-kustomize-결합하기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kubernates-deploy-에-helm-과-kustomize-결합하기"}},[s._v("#")]),s._v(" kubernates deploy 에 helm 과 kustomize 결합하기")]),s._v(" "),n("p",[s._v("보통 kubernates 에 deploy 를 하기 위해서 yaml 파일을 사용하게 되는데요."),n("br"),s._v("\nargoCD 를 예를 들면 아래 제공되는 yaml 파일을 이용해서 배포할 수 있습니다.")]),s._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://github.com/argoproj/argo-cd/blob/master/manifests/install.yaml",target:"_blank",rel:"noopener noreferrer"}},[n("code",[s._v("argoCD manifests/install.yaml")]),n("OutboundLink")],1),n("br"),s._v("\n그런데 배포에 필요한 세부적인 설정이 필요한 경우 제공된 yaml 파일을 직접 수정해야 하기 때문에 매우 번거로운 방법입니다."),n("br"),s._v("\n그래서 보통 helm package 로 배포를 하게 되는데요."),n("br"),s._v("\nhelm package 를 이용한 배포 방법은 values.yaml 을 통해서 상세설정을 할 수 있는 좋은 방법으로 많이 사용되고 있습니다."),n("br"),s._v("\n이 글은 helm package 와 kustomize 를 결합하는 배포 방법에 대해 소개해 드리려고 합니다."),n("br"),s._v("\nyaml 파일을 이용하는 방법과 helm 단독 배포 방식 그리고 kustomize 를 결합한 방법이 어떤 차이와 이점이 있는지 비교하면서 보시기 바랍니다."),n("br"),s._v("\n추가로 argoCD 가 helm, kustomize 를 처리하는 방식을 이해하는데도 도움이 됩니다.")])]),s._v(" "),n("p",[s._v("[이 글을 읽기전에 아래 내용을 숙지하세요.]")]),s._v(" "),n("ul",[n("li",[s._v("이 가이드는 argoCD 를 설치하는 가이드는 아닙니다.")]),s._v(" "),n("li",[s._v("helm 배포와 kustomzie 배포 방법을 비교하기 위해 argoCD 설치를 예시로 사용하였습니다.")])]),s._v(" "),n("p",[s._v("[실습을 위해서는 로컬 환경에 맞게 아래 프로그램 설치가 필요합니다.]")]),s._v(" "),n("ul",[n("li",[s._v("docker-desktop 설치")]),s._v(" "),n("li",[s._v("helm cli 3.0 이상 설치")]),s._v(" "),n("li",[s._v("kubectl cli 설치")]),s._v(" "),n("li",[s._v("kustomize cli 설치")])]),s._v(" "),n("p",[s._v("자 그럼 실습을 시작해 볼까요?")]),s._v(" "),n("h2",{attrs:{id:"case-1-helm-install-을-사용하여-배포하는-방법"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#case-1-helm-install-을-사용하여-배포하는-방법"}},[s._v("#")]),s._v(" [Case 1] helm install 을 사용하여 배포하는 방법")]),s._v(" "),n("p",[s._v("helm install 배포 방법은 가장 많이 사용하는 방식으로 대부분 익숙한 방법입니다."),n("br"),s._v("\n최종 모습과 비교하기 위한 것이니 참고로 보시기 바랍니다.")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("helm install 을 이용한 argocCD 배포")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## helm repoistory 를 등록합니다.")]),s._v("\n$ helm repo "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" argo https://argoproj.github.io/argo-helm\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"argo"')]),s._v(" has been added to your repositories\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## namespace 를 생성합니다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## kubernates(docker desktop) 에 접속한 상태여야 합니다.")]),s._v("\n$ kubectl create ns my-argocd\nnamespace/my-argocd created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## helm install")]),s._v("\n$ helm "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" my-argocd -n my-argocd argo/argo-cd\nNAME: my-argocd\nLAST DEPLOYED: Mon Mar  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":59:10 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\nNAMESPACE: my-argocd\nSTATUS: deployed\nREVISION: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## pod 확인")]),s._v("\n$ kubectl get pod -n my-argocd\nNAME                                                READY   STATUS    RESTARTS   AGE\nmy-argocd-application-controller-844b4d5947-5g6pn   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          23s\nmy-argocd-dex-server-556657c7f4-8wsn6               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          23s\nmy-argocd-redis-88db9fff8-jztjj                     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          23s\nmy-argocd-repo-server-66c569469c-4n79h              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          23s\nmy-argocd-server-674ffff767-dt6r4                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          23s\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## helm release 확인")]),s._v("\n$ helm list\nNAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION\nmy-argocd       my-argocd       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-07 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":14:30.62671 +0900 KST     deployed        argo-cd-3.35.2  v2.2.5\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("replicas 를 변경하기 위해 아래 내용으로 my-values.yaml 파일을 생성합니다.")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# my-values.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("controller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("my-values.yaml 로 helm 을 배포합니다.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## helm upgrade 를 사용합니다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## my-values.yml 파일이 있는 폴더에서 실행합니다. ")]),s._v("\n$ helm upgrade my-argocd -n my-argocd argo/argo-cd -f my-values.yaml\nRelease "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd"')]),s._v(" has been upgraded. Happy Helming"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\nNAME: my-argocd\nLAST DEPLOYED: Mon Mar  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":25:27 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\nNAMESPACE: my-argocd\nSTATUS: deployed\nREVISION: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## pod count 변화 확인")]),s._v("\n$ kubectl get pod -n my-argocd\nNAME                                                READY   STATUS              RESTARTS   AGE\nmy-argocd-application-controller-844b4d5947-5g6pn   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nmy-argocd-application-controller-844b4d5947-wvwrj   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     ContainerCreating   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2s\nmy-argocd-dex-server-556657c7f4-8wsn6               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nmy-argocd-redis-88db9fff8-jztjj                     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nmy-argocd-repo-server-66c569469c-4n79h              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nmy-argocd-server-674ffff767-c8b2r                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     ContainerCreating   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2s\nmy-argocd-server-674ffff767-dt6r4                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("helm uninstall 명령어로 배포된 helm 과 리소스를 같이 삭제할 수 있습니다.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## helm uninstall")]),s._v("\n$ helm uninstall my-argocd\nrelease "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd"')]),s._v(" uninstalled\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"case-2-helm-template-을-사용하여-배포하는-방법"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#case-2-helm-template-을-사용하여-배포하는-방법"}},[s._v("#")]),s._v(" [Case 2] helm template 을 사용하여 배포하는 방법")]),s._v(" "),n("p",[s._v("이 방법은 helm package 를 yaml 형태로 만든 다음 kubectl apply -f 명령어를 사용하여 배포하는 방식입니다."),n("br"),s._v("\n이 방법을 사용하시는 분은 거의 없을거란 생각이 드는데요."),n("br"),s._v("\n이 방법의 이점은 helm 를 배포하기전에 yaml 파일을 미리 검토해 볼 수 있고"),n("br"),s._v("\nkubectl diff 명령어로 배포된 형상과 미리 비교할 수도 있습니다."),n("br"),s._v("\n결과적으로 helm package 의 이점과 yaml 파일의 이점을 동시에 갖게 되는데요."),n("br"),s._v("\n참고로 argoCD 가 helm 을 처리할때 내부적으로 이 방식으로 처리하고 있습니다.")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("helm template 으로 yaml 파일을 생성하고 kubectl apply 로 배포합니다.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## helm template 으로 temp.yaml 파일을 생성합니다.")]),s._v("\n$ helm template my-argocd argo/argo-cd "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" temp.yaml\ncreated temp.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## temp.yaml 파일의 내용을 확인합니다.")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" temp.yaml\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".생략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## kubectl apply 로 배포합니다.")]),s._v("\n$ kubectl apply -f temp.yaml -n my-argocd\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".생략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment.apps/my-argocd-application-controller created\ndeployment.apps/my-argocd-repo-server created\ndeployment.apps/my-argocd-server created\ndeployment.apps/my-argocd-dex-server created\ndeployment.apps/my-argocd-redis created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## pod 확인")]),s._v("\n$ kubectl get pod -n my-argocd\nNAME                                                READY   STATUS    RESTARTS   AGE\nmy-argocd-application-controller-844b4d5947-rt45c   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          39s\nmy-argocd-dex-server-556657c7f4-xbjr8               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          38s\nmy-argocd-redis-88db9fff8-wxrx4                     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          38s\nmy-argocd-repo-server-66c569469c-b4q7x              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          39s\nmy-argocd-server-674ffff767-5gzch                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          38s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("replicas 를 변경하기 위해 아래 내용으로 my-values.yaml 파일을 생성합니다.")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# my-values.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("controller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("my-values.yaml 을 적용하여 배포합니다.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## my-values.yaml 로 temp.yaml 파일을 생성합니다.")]),s._v("\n$ helm template my-argocd argo/argo-cd -f my-values.yaml "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" temp.yaml\ncreated temp.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## temp.yaml 파일의 내용에서 replicas: 부분을 확인합니다.")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" temp.yaml "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" replicas: -B "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".생략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## kubectl diff 명령어로 이전 배포 항목과 비교합니다.")]),s._v("\n$ kubectl "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("diff")]),s._v(" -f temp.yaml -n my-argocd "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" diff.yaml\ncreated diff.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## diff.yaml 파일을 확인합니다.")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" diff.yaml\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".중략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n-  replicas: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n+  replicas: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".중략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n-  replicas: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n+  replicas: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".중략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## --dry-run=client 옵션으로 yaml 파일 validation 을 체크합니다.")]),s._v("\n$ kubectl apply -f temp.yaml -n my-argocd --dry-run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".중략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment.apps/my-argocd-application-controller configured "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndeployment.apps/my-argocd-repo-server configured "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndeployment.apps/my-argocd-server configured "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndeployment.apps/my-argocd-dex-server configured "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndeployment.apps/my-argocd-redis configured "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## --dry-run=server 옵션으로 yaml 파일이 배포되는 시점의 validation 을 체크합니다.")]),s._v("\n$ kubectl apply -f temp.yaml -n my-argocd --dry-run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".중략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment.apps/my-argocd-application-controller configured "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndeployment.apps/my-argocd-repo-server unchanged "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndeployment.apps/my-argocd-server configured "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndeployment.apps/my-argocd-dex-server unchanged "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndeployment.apps/my-argocd-redis unchanged "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## --dry-run=server 옵션은 label selector, pvc spec 변경 등 pod 가 실행중인 상태에서 변경할 수 없는 리소스를 체크해 줍니다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## label selector, pvc spec 변경이 필요한 경우에는 기존 리소스를 먼저 삭제하고 배포해야 합니다.")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 최종 yaml 파일을 배포합니다.")]),s._v("\n$ kubectl apply -f temp.yaml -n my-argocd\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".생략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment.apps/my-argocd-application-controller configured\ndeployment.apps/my-argocd-repo-server unchanged\ndeployment.apps/my-argocd-server configured\ndeployment.apps/my-argocd-dex-server unchanged\ndeployment.apps/my-argocd-redis unchanged\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## pod count 변화 확인")]),s._v("\n$ kubectl get pod -n my-argocd\nNAME                                                READY   STATUS              RESTARTS   AGE\nmy-argocd-application-controller-844b4d5947-5g6pn   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nmy-argocd-application-controller-844b4d5947-wvwrj   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     ContainerCreating   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2s\nmy-argocd-dex-server-556657c7f4-8wsn6               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nmy-argocd-redis-88db9fff8-jztjj                     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nmy-argocd-repo-server-66c569469c-4n79h              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nmy-argocd-server-674ffff767-c8b2r                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     ContainerCreating   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2s\nmy-argocd-server-674ffff767-dt6r4                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("kubectl delete -f 명령어로 배포된 리소스를 삭제할 수 있습니다.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## kubectl delete 사용")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 이전에 배포했던 temp.yaml 파일을 사용해야 합니다.")]),s._v("\n$ kubectl delete -f temp.yaml -n my-argocd\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".중략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd-application-controller"')]),s._v(" deleted\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd-repo-server"')]),s._v(" deleted\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd-server"')]),s._v(" deleted\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd-dex-server"')]),s._v(" deleted\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd-redis"')]),s._v(" deleted\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## namesapce 를 삭제하는 방법도 있으나, namespace 범위밖에 있는 리소스가 있기 때문에")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 가능한 이전에 배포했던 temp.yaml 파일을 사용해서 삭제하도록 합니다.")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"final-case-helm-과-kustomize-의-결합"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#final-case-helm-과-kustomize-의-결합"}},[s._v("#")]),s._v(" [Final Case] helm 과 kustomize 의 결합")]),s._v(" "),n("p",[s._v("이제 최종적으로 소개드리려고 하는 helm 과 kustomize 의 결합 방법입니다."),n("br"),s._v("\n이 방법은 위 과정에서 진행해본 helm package, helm template 방식에 kustomize 의 이점을 더할 수 있는 방법입니다."),n("br"),s._v("\nkubernates 에서 설명하는 kustomize 의 사용법과 장점은 아래 사아트를 참고하시기 바랍니다.")]),s._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://kubernetes.io/ko/docs/tasks/manage-kubernetes-objects/kustomization/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://kubernetes.io/ko/docs/tasks/manage-kubernetes-objects/kustomization/"),n("OutboundLink")],1),n("br"),s._v("\nkustomize 의 공식 사이트에서 상세 스펙을 확인할 수 있습니다."),n("br"),s._v(" "),n("a",{attrs:{href:"https://kustomize.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://kustomize.io/"),n("OutboundLink")],1)])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("kustomize helm plug-in 을 사용하여 helm package 를 사용할 수 있습니다.")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## kustomization.yaml 파일을 생성하고 아래 내용을 작성합니다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("helmCharts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" argo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//argoproj.github.io/argo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("helm\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3.26.5\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("releaseName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("argocd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("argocd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valuesFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("values.yaml \n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("includeCRDs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CustomResourceDefinition 이 있을 경우 true")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## kustomize build 명령어로 배포용 yaml 파일을 생성합니다.")]),s._v("\n$ kustomize build "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" --enable-helm "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" temp.yaml\ncreated temp.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## temp.yaml 파일의 내용을 확인합니다.")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" temp.yaml\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".생략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 최종 yaml 파일을 배포합니다.")]),s._v("\n$ kubectl apply -f temp.yaml -n my-argocd\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".생략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment.apps/my-argocd-application-controller created\ndeployment.apps/my-argocd-dex-server created\ndeployment.apps/my-argocd-redis created\ndeployment.apps/my-argocd-repo-server created\ndeployment.apps/my-argocd-server created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## pod  확인")]),s._v("\n$ kubectl get pod -n my-argocd\nNAME                                                READY   STATUS    RESTARTS   AGE\nmy-argocd-application-controller-57b9d9f584-ctctl   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          25s\nmy-argocd-application-controller-57b9d9f584-rq5qz   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          25s\nmy-argocd-dex-server-b8cdffbbc-dcksr                "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          25s\nmy-argocd-redis-7b46b74bc9-4dbgc                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          25s\nmy-argocd-repo-server-5745dc9456-grg79              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          25s\nmy-argocd-server-b598c7865-5jd8t                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          24s\nmy-argocd-server-b598c7865-b92gt                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          24s\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 그럼 kubectl apply -k 명령어로 배포가 될까요?")]),s._v("\n$ kubectl apply -k "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nerror: json: unknown field "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"includeCRDs"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -k 로는 배포가 되지 않습니다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 이유는 kustomize build 에서 --enable-helm 옵션이 필요하기 때문입니다.")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 실제로 argoCD 를 사용해서 배포할 경우 위와 같은 오류가 발생합니다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# argoCD 에서 kustomize 명령어에 옵션을 추가하도록 설정이 필요합니다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# argocd values.yaml 에 아래 설정을 추가합니다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kustomize.buildOptions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("enable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("helm=true\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("kubectl delete -f 명령어로 배포된 리소스를 삭제할 수 있습니다.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## kubectl delete 사용")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 이전에 배포했던 temp.yaml 파일을 사용해야 합니다.")]),s._v("\n$ kubectl delete -f temp.yaml -n my-argocd\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".중략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd-application-controller"')]),s._v(" deleted\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd-repo-server"')]),s._v(" deleted\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd-server"')]),s._v(" deleted\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd-dex-server"')]),s._v(" deleted\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-argocd-redis"')]),s._v(" deleted\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## namesapce 를 삭제하는 방법도 있으나, namespace 범위밖에 있는 리소스가 있기 때문에")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 가능한 이전에 배포했던 temp.yaml 파일을 사용해서 삭제하도록 합니다.")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])])])]),s._v(" "),n("p",[s._v("여기까지는 helm template 방식과 별 차이가 없어 보입니다."),n("br"),s._v("\n차이점은 helm repository 를 등록하지 않아도 사용할 수 있다는 것입니다."),n("br"),s._v("\n이게 이점이라고 할수는 없겠죠?"),n("br"),s._v("\n이제 kustomize 의 장점을 활용해 볼 차례입니다."),n("br"),s._v("\n아래와 같은 케이스에서 사용할때 kustomize 는 그 진가를 발휘합니다.")]),s._v(" "),n("h3",{attrs:{id:"case-1-helm-chart-에는-없는-resource-를-배포해줘야-할때"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#case-1-helm-chart-에는-없는-resource-를-배포해줘야-할때"}},[s._v("#")]),s._v(" [Case 1] helm chart 에는 없는 resource 를 배포해줘야 할때")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 아래와 같은 secret 을 추가로 배포하기 위해 my-secret.yaml 파일을 생성한다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# my-secret.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Secret\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("argocd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("secret\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Opaque\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stringData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bar\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## kustomization.yaml 파일에 my-secret.yaml 리소스를 추가한다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("helmCharts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" argo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//argoproj.github.io/argo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("helm\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3.26.5\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("releaseName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("argocd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("argocd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valuesFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("values.yaml \n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("includeCRDs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("secret.yaml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## kustomize build 명령어로 배포용 yaml 파일을 생성합니다.")]),s._v("\n$ kustomize build "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" --enable-helm "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" temp.yaml\ncreated temp.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## temp.yaml 파일의 내용을 확인합니다.")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" temp.yaml "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" my-argocd-secret -A "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -B "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 아래와 유사한 출력을 볼 수 있습니다.")]),s._v("\napiVersion: v1\nkind: Secret\nmetadata:\n  name: my-argocd-secret\nstringData:\n  foo: bar\ntype: Opaque\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## kubectl diff 명령어로 이전 배포 항목과 비교합니다.")]),s._v("\n$ kubectl "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("diff")]),s._v(" -f temp.yaml -n my-argocd\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 아래와 유사한 출력을 볼 수 있습니다.")]),s._v("\n+apiVersion: v1\n+data:\n+  foo: YmFy\n+kind: Secret\n+metadata:\n+  name: my-argocd-secret\n+  namespace: my-argocd\n+type: Opaque\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 최종 yaml 파일을 배포합니다.")]),s._v("\n$ kubectl apply -f temp.yaml -n my-argocd\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".중략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nsecret/my-argocd-secret created\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".중략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h3",{attrs:{id:"case-2-여러개의-helm-chart-를-하나로-묶어서-관리하고-싶을때"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#case-2-여러개의-helm-chart-를-하나로-묶어서-관리하고-싶을때"}},[s._v("#")]),s._v(" [Case 2] 여러개의 helm chart 를 하나로 묶어서 관리하고 싶을때")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 2개의 helm chart 를 배포하는 kustomization.yaml 을 각각 생성합니다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 아래와 같은 폴더 구조를 생성합니다.")]),s._v("\n./root\n  ./argocd\n    kustomization.yaml\n    my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("values.yaml\n  ./argocd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("redis\n    kustomization.yaml\n    my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("values.yaml\n  kustomization.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ./argocd/kustomization.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("helmCharts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" argo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//argoproj.github.io/argo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("helm\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3.26.5\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("releaseName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("argocd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("argocd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valuesFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("values.yaml\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("includeCRDs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ./argocd/my-values.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("controller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ./argocd-redis/kustomization.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("helmCharts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//charts.bitnami.com/bitnami\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 16.4.0\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("releaseName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("argocd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("argocd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valuesFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("values.yaml\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("includeCRDs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ./argocd-redis/my-values.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("architecture")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" standalone\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ./kustomization.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bases")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" argocd\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" argocd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("redis\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ./root 폴더에서 yaml 파일 명령을 실행합니다.")]),s._v("\n$ kustomize build "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" --enable-helm "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" temp.yaml\ncreated temp.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## temp.yaml 파일을 확인합니다.")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" temp.yaml\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".생략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 최종 yaml 파일을 배포합니다.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## my-argocd-redis-master 가 추가로 배포된 것을 확인할 수 있습니다.")]),s._v("\n$ kubectl apply -f temp.yaml -n my-argocd\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".중략"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment.apps/my-argocd-application-controller created\ndeployment.apps/my-argocd-dex-server created\ndeployment.apps/my-argocd-redis created\ndeployment.apps/my-argocd-repo-server created\ndeployment.apps/my-argocd-server created\nstatefulset.apps/my-argocd-redis-master created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## pod  확인")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## my-argocd-redis-master 가 추가로 배포된 것을 확인할 수 있습니다.")]),s._v("\n$ kubectl get pod -n my-argocd\nNAME                                                READY   STATUS    RESTARTS   AGE\nmy-argocd-application-controller-57b9d9f584-2gp82   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          30s\nmy-argocd-application-controller-57b9d9f584-8jbw6   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          30s\nmy-argocd-dex-server-b8cdffbbc-n4jln                "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          29s\nmy-argocd-redis-7b46b74bc9-v5nsg                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          29s\nmy-argocd-redis-master-0                            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          28s\nmy-argocd-repo-server-5745dc9456-47g9g              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          29s\nmy-argocd-server-b598c7865-j55wb                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          28s\nmy-argocd-server-b598c7865-kw6lz                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          28s\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h2",{attrs:{id:"argocd-와-연관성"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#argocd-와-연관성"}},[s._v("#")]),s._v(" argoCD 와 연관성")]),s._v(" "),n("p",[s._v("위에서 실습한 명령어들은 실제로 argoCD 의 내부 동작에서 사용되는 명령어와 일치합니다.")]),s._v(" "),n("ul",[n("li",[s._v("helm template : helm chart type argoCD application 에서 refresh 를 할 때\n"),n("ul",[n("li",[s._v("helm pull : helm chart pull 포함")])])]),s._v(" "),n("li",[s._v("kustomize build : kustomize type argoCD application 에서 refresh 를 할 때")]),s._v(" "),n("li",[s._v("kubectl diff : argoCD 화면에서 App Diff 버튼을 클릭할 때")])]),s._v(" "),n("p",[s._v(".끝.")])])}),[],!1,null,null,null);a.default=e.exports}}]);