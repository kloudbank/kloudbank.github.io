<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis HA with standalone | Kloudbank</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Kloudbank Blog, Docs.">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.fd89504a.css" as="style"><link rel="preload" href="/assets/js/app.fc570ef8.js" as="script"><link rel="preload" href="/assets/js/4.f98f6a05.js" as="script"><link rel="preload" href="/assets/js/1.89d62b8c.js" as="script"><link rel="preload" href="/assets/js/51.745f73c5.js" as="script"><link rel="prefetch" href="/assets/js/10.b085d46d.js"><link rel="prefetch" href="/assets/js/11.79d188d6.js"><link rel="prefetch" href="/assets/js/12.e0b954d4.js"><link rel="prefetch" href="/assets/js/13.39b1785f.js"><link rel="prefetch" href="/assets/js/14.d5f48e64.js"><link rel="prefetch" href="/assets/js/15.ea667e15.js"><link rel="prefetch" href="/assets/js/16.2ca54160.js"><link rel="prefetch" href="/assets/js/17.6caf30fd.js"><link rel="prefetch" href="/assets/js/18.3a770d6e.js"><link rel="prefetch" href="/assets/js/19.11380409.js"><link rel="prefetch" href="/assets/js/20.df412b5d.js"><link rel="prefetch" href="/assets/js/21.d68e381b.js"><link rel="prefetch" href="/assets/js/22.4de6b0bf.js"><link rel="prefetch" href="/assets/js/23.0e81dadd.js"><link rel="prefetch" href="/assets/js/24.4580dc23.js"><link rel="prefetch" href="/assets/js/25.ce22c978.js"><link rel="prefetch" href="/assets/js/26.6f781494.js"><link rel="prefetch" href="/assets/js/27.35c5e8d0.js"><link rel="prefetch" href="/assets/js/28.834c126c.js"><link rel="prefetch" href="/assets/js/29.d1ad8583.js"><link rel="prefetch" href="/assets/js/3.9fb88f4e.js"><link rel="prefetch" href="/assets/js/30.d523db0e.js"><link rel="prefetch" href="/assets/js/31.81bb3668.js"><link rel="prefetch" href="/assets/js/32.ab2fb8cb.js"><link rel="prefetch" href="/assets/js/33.287a8737.js"><link rel="prefetch" href="/assets/js/34.a7a3d153.js"><link rel="prefetch" href="/assets/js/35.03057da4.js"><link rel="prefetch" href="/assets/js/36.ef0f5e9a.js"><link rel="prefetch" href="/assets/js/37.53b1821e.js"><link rel="prefetch" href="/assets/js/38.9e3535f1.js"><link rel="prefetch" href="/assets/js/39.d45a862e.js"><link rel="prefetch" href="/assets/js/40.815b6fb1.js"><link rel="prefetch" href="/assets/js/41.a056384e.js"><link rel="prefetch" href="/assets/js/42.92c5f01a.js"><link rel="prefetch" href="/assets/js/43.8d987148.js"><link rel="prefetch" href="/assets/js/44.aa9ef9a0.js"><link rel="prefetch" href="/assets/js/45.77249588.js"><link rel="prefetch" href="/assets/js/46.6fa22cbf.js"><link rel="prefetch" href="/assets/js/47.f7ac78b1.js"><link rel="prefetch" href="/assets/js/48.d735908c.js"><link rel="prefetch" href="/assets/js/49.cc159fb5.js"><link rel="prefetch" href="/assets/js/5.6eacb8c9.js"><link rel="prefetch" href="/assets/js/50.2534f07e.js"><link rel="prefetch" href="/assets/js/52.3faa2ed9.js"><link rel="prefetch" href="/assets/js/53.956630e8.js"><link rel="prefetch" href="/assets/js/54.272565ea.js"><link rel="prefetch" href="/assets/js/55.1dd96dae.js"><link rel="prefetch" href="/assets/js/56.61965672.js"><link rel="prefetch" href="/assets/js/57.cc4c167f.js"><link rel="prefetch" href="/assets/js/58.a61ff261.js"><link rel="prefetch" href="/assets/js/59.55ff84a0.js"><link rel="prefetch" href="/assets/js/6.928ad7d5.js"><link rel="prefetch" href="/assets/js/60.442a0b3c.js"><link rel="prefetch" href="/assets/js/61.96206876.js"><link rel="prefetch" href="/assets/js/62.26ae1d67.js"><link rel="prefetch" href="/assets/js/63.f8918014.js"><link rel="prefetch" href="/assets/js/64.c5884ccd.js"><link rel="prefetch" href="/assets/js/65.07d973c3.js"><link rel="prefetch" href="/assets/js/66.fdc39f06.js"><link rel="prefetch" href="/assets/js/67.f071ef3c.js"><link rel="prefetch" href="/assets/js/68.eb58618b.js"><link rel="prefetch" href="/assets/js/69.e41e3506.js"><link rel="prefetch" href="/assets/js/7.f55b58b7.js"><link rel="prefetch" href="/assets/js/70.cae6df63.js"><link rel="prefetch" href="/assets/js/71.8acb8f93.js"><link rel="prefetch" href="/assets/js/72.c1943dc1.js"><link rel="prefetch" href="/assets/js/73.e71cae3d.js"><link rel="prefetch" href="/assets/js/74.4f74b7ed.js"><link rel="prefetch" href="/assets/js/75.844e8363.js"><link rel="prefetch" href="/assets/js/76.20b75fe6.js"><link rel="prefetch" href="/assets/js/77.49d30161.js"><link rel="prefetch" href="/assets/js/78.52df56c6.js"><link rel="prefetch" href="/assets/js/79.5b23ee41.js"><link rel="prefetch" href="/assets/js/8.f2646dfc.js"><link rel="prefetch" href="/assets/js/80.f9bc407a.js"><link rel="prefetch" href="/assets/js/81.43f709de.js"><link rel="prefetch" href="/assets/js/82.01385703.js"><link rel="prefetch" href="/assets/js/83.0bc4fc30.js"><link rel="prefetch" href="/assets/js/9.e34c86f1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fd89504a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Kloudbank</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>Kloudbank Blog, Docs.</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>noisonnoiton</span>
            
          <span data-v-25ba6db2>2021 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Kloudbank" class="logo"> <span class="site-name">Kloudbank</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Guide/" class="nav-link"><i class="undefined"></i>
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/categories/Cloud/" class="nav-link"><i class="undefined"></i>
  Cloud
</a></li><li class="dropdown-item"><!----> <a href="/categories/Ref. Arch./" class="nav-link"><i class="undefined"></i>
  Ref. Arch.
</a></li><li class="dropdown-item"><!----> <a href="/categories/Cloud Native App./" class="nav-link"><i class="undefined"></i>
  Cloud Native App.
</a></li><li class="dropdown-item"><!----> <a href="/categories/Machine Learning/" class="nav-link"><i class="undefined"></i>
  Machine Learning
</a></li><li class="dropdown-item"><!----> <a href="/categories/GitOps/" class="nav-link"><i class="undefined"></i>
  GitOps
</a></li><li class="dropdown-item"><!----> <a href="/categories/Multi Cloud/" class="nav-link"><i class="undefined"></i>
  Multi Cloud
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/001_hcpsrecq/" class="nav-link"><i class="undefined"></i>
  GitOps-Task Runner
</a></li><li class="dropdown-item"><!----> <a href="/docs/002_bpcollab/" class="nav-link"><i class="undefined"></i>
  Collab. Portal
</a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kloudbank" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-39576ba9> <h3 class="name" data-v-39576ba9>
    noisonnoiton
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>68</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>18</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Guide/" class="nav-link"><i class="undefined"></i>
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/categories/Cloud/" class="nav-link"><i class="undefined"></i>
  Cloud
</a></li><li class="dropdown-item"><!----> <a href="/categories/Ref. Arch./" class="nav-link"><i class="undefined"></i>
  Ref. Arch.
</a></li><li class="dropdown-item"><!----> <a href="/categories/Cloud Native App./" class="nav-link"><i class="undefined"></i>
  Cloud Native App.
</a></li><li class="dropdown-item"><!----> <a href="/categories/Machine Learning/" class="nav-link"><i class="undefined"></i>
  Machine Learning
</a></li><li class="dropdown-item"><!----> <a href="/categories/GitOps/" class="nav-link"><i class="undefined"></i>
  GitOps
</a></li><li class="dropdown-item"><!----> <a href="/categories/Multi Cloud/" class="nav-link"><i class="undefined"></i>
  Multi Cloud
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/001_hcpsrecq/" class="nav-link"><i class="undefined"></i>
  GitOps-Task Runner
</a></li><li class="dropdown-item"><!----> <a href="/docs/002_bpcollab/" class="nav-link"><i class="undefined"></i>
  Collab. Portal
</a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kloudbank" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Introduction</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/003_refarch/" aria-current="page" class="sidebar-link">Overview</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Modern API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/003_refarch/modernapi.html" class="sidebar-link">Low Code API 솔루션 소개</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/003_refarch/perftest.html" class="sidebar-link">Redis 성능 측정</a></li><li><a href="/blogs/003_refarch/hatest.html" aria-current="page" class="active sidebar-link">Redis HA with standalone</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>EIP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/003_refarch/camel.html" class="sidebar-link">Apache Camel and EIP</a></li><li><a href="/blogs/003_refarch/legacy.html" class="sidebar-link">Legacy Interface 개발</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Research ('20)</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/003_refarch/keycloak.html" class="sidebar-link">Keycloak</a></li><li><a href="/blogs/003_refarch/harbor.html" class="sidebar-link">Harbor</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Redis HA with standalone</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>noisonnoiton</span>
            
          <span data-v-25ba6db2>2021 - </span>
          2022
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><section><div class="page-title"><h1 class="title">Redis HA with standalone</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>noisonnoiton</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>4/14/2021</span></i> <!----> <i class="tags iconfont reco-tag" data-v-f875f3fc><span class="tag-item" data-v-f875f3fc>kubernetes</span><span class="tag-item" data-v-f875f3fc>database</span></i></div></div> <div class="theme-reco-content content__default"><ul><li>제안배경
<ul><li>Redis 를 HA 로 구성하기 위해서는 cluster 나 sentinel 구성을 필요로 함</li> <li>cluster 나 sentinel 구성은 복잡한 구조와 기본 3개 이상의 인스턴스가 필요</li></ul></li> <li>Redis standalone HA 구성
<ul><li>Redis standalone 구성만으로 HA 구성을 검토</li> <li>개별 Redis 간 Data Sync 를 위해 side-car, envoy proxy, redis proxy 등을 검토</li></ul></li></ul> <h2 id="standalone-sidecar"><a href="#standalone-sidecar" class="header-anchor">#</a> Standalone + Sidecar</h2> <ul><li>Redis Master-Master HA 구성 방안</li> <li>각 Redis Standalone service 에 Sidecar 를 구성하여 Replication 이 가능한지 검토
<ul><li>Dynomite, Envoy etc.</li></ul></li></ul> <h3 id="netflix-dynomite"><a href="#netflix-dynomite" class="header-anchor">#</a> Netflix Dynomite</h3> <h4 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h4> <p>Dynomite 는 다양한 key-value pair 스토리지 엔진을 Amazon DynamoDB와 유사하게 구현할 수 있다. 현재 Redis 및 Memcached 등에 사용 가능하다. Dynomite는 multi-datacenter replication 을 지원하며, 고 가용성을 위한 설계가 적용되어 있다.</p> <p>Dynomite 의 궁극적인 목표는 본질적으로 해당 기능을 제공하지 않는 스토리지 엔진에서 고 가용성 및 cross-datacenter replication 을 구현할 수 있도록 하는 것이다.</p> <blockquote><p>Dynomite Github Wiki 참조<br> <a href="https://github.com/Netflix/dynomite/wiki" target="_blank" rel="noopener noreferrer">https://github.com/Netflix/dynomite/wiki<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
Amazon DynamoDB Docs<br> <a href="https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/Introduction.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/Introduction.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h4 id="architecture-overview"><a href="#architecture-overview" class="header-anchor">#</a> Architecture Overview</h4> <ul><li><p>Replication Flow</p> <ul><li>On-premise 환경이라 가정할 때, Dynomite와 Target 스토리지 엔진은 동일한 노드에서 실행되며, Client 는 Dynomite 에 Request.</li> <li>해당 Request 는 동일한 노드의 스토리지 엔진 또는 다른 노드에서 실행되는 Dynomite 프로세스로 proxy.</li> <li>Request 가 Dynomite Node 를 통과하면, data 가 복제되어 대상 스토리지에 저장됨.</li> <li>이후, Client 는 Dynomite 혹은 스토리지의 API Call 을 통하여, 데이터를 다시 조회.</li></ul></li></ul> <p><img src="https://github.com/Netflix/dynomite/wiki/images/dynomite-architecture.png" width="800px" height="450px" title="dynomite-arch" alt="dynomite-arch"></p> <blockquote><p>Dynomite Architecture 참조<br> <a href="https://github.com/Netflix/dynomite/wiki/Architecture" target="_blank" rel="noopener noreferrer">https://github.com/Netflix/dynomite/wiki/Architecture<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h4 id="구성-architecture"><a href="#구성-architecture" class="header-anchor">#</a> 구성 Architecture</h4> <p>Kubernetes 환경에서 제공되는 Redis Standalone 서비스의 고 가용성 확보를 위한 구성 방안<br>
: Dynomite Sidecar 를 통한 datacenter replication</p> <ul><li>Redis Standalone + Dynomite Sidecar Deployment
<ul><li>각 Redis Deployment 를 component로 묶어서 공통으로 request 를 처리할 수 있는 service 생성</li> <li>Client 는 common service 에 request.</li> <li>common service 에서 각 dynomite pod 에 Load Balancing.</li> <li>dynomite pod 에 write 작업 요청 시, target redis 에 write 를 수행하고, dynomite seed 에 설정된 pod 으로 proxy.</li> <li>proxy 요청을 받은 dynomite 또한, 자신의 target redis 에 write 를 수행<br>
| <u><em>dynomite 에서 target redis 에 request 할 때, 각 redis 별로 생성된 k8s service 를 통하여 호출 (아래 그림에서는 각 service 생략)</em></u></li></ul></li></ul> <img src="https://www.plantuml.com/plantuml/svg/ZP9FIyGm4CNl-HH3J-kXiAdWdqLa5t4H10_sA1wopUnIR9CbYOf8lxlJIL8NsGLlatc_rvSyklH1kV3UTwAuwreqeG3beU5H6AiHYll7cfVuvk5R0Bmqjk-jAJswZxR1LpRGQZoJ74tFg5iF3ojswWqR0HmsGPbTHu0RWN8-hn91Ku80j0fgetoccE29e8JCz9UnVHlmZEELoz9mAaXEGV8_GV9qa9o21Z7aajQff6qioGVhr8w4ftKDTJmmOBQUJB5WA6z_cyi3bDf-cb7XhCN-IjBJZgjLLXcTjFo4nVxY_F8wgjLVjJfK9TnCtnJPdXnyvMmwt2tHQFfpVW00" alt="uml diagram"> <h4 id="구성-내역"><a href="#구성-내역" class="header-anchor">#</a> 구성 내역</h4> <ul><li>Redis Standalone + Dynomite Sidecar Deployment</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">...</span>

    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token comment"># Redis Standalone</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>dyno<span class="token punctuation">-</span><span class="token number">001</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>latest
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">6379</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span> 
          <span class="token punctuation">-</span> redis<span class="token punctuation">-</span>server
          <span class="token punctuation">-</span> <span class="token string">&quot;/redis-master/redis.conf&quot;</span>
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 500m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 300m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> shared<span class="token punctuation">-</span>storage
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>config
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /redis<span class="token punctuation">-</span>master
      <span class="token comment"># Dynomite Sidecar</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dynomite
        <span class="token key atrule">image</span><span class="token punctuation">:</span> dynomitedb/dynomite
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">999</span>
          <span class="token key atrule">runAsGroup</span><span class="token punctuation">:</span> <span class="token number">999</span>
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token comment"># Dynomite Listener</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8101</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> dyno
          <span class="token comment"># Dynomite Client</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8102</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> dyno<span class="token punctuation">-</span>client
          <span class="token comment"># Dynomite Stats/admin</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">22222</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> dyno<span class="token punctuation">-</span>admin
        <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dynomite&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/etc/dynomitedb/conf/dynomite.yaml&quot;</span><span class="token punctuation">]</span>
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 500m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 300m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dyno<span class="token punctuation">-</span>config
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/dynomitedb/conf

<span class="token punctuation">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><ul><li>Dynomite target server 및 seed 구성 내역 (dynomite.yaml)</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dyn_o_mite</span><span class="token punctuation">:</span>
  <span class="token key atrule">datacenter</span><span class="token punctuation">:</span> dc1
  <span class="token key atrule">rack</span><span class="token punctuation">:</span> rack1
  <span class="token key atrule">dyn_listen</span><span class="token punctuation">:</span> 0.0.0.0<span class="token punctuation">:</span><span class="token number">8101</span>
  <span class="token key atrule">listen</span><span class="token punctuation">:</span> 0.0.0.0<span class="token punctuation">:</span><span class="token number">8102</span>
  <span class="token key atrule">dyn_seeds</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> redis<span class="token punctuation">-</span>dyno<span class="token punctuation">-</span>002<span class="token punctuation">:</span>8101<span class="token punctuation">:</span>rack2<span class="token punctuation">:</span>dc2<span class="token punctuation">:</span><span class="token number">0</span> <span class="token comment"># proxy 대상이되는 dynomite seed</span>
  <span class="token key atrule">servers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> redis<span class="token punctuation">-</span>dyno<span class="token punctuation">-</span>001<span class="token punctuation">:</span>6379<span class="token punctuation">:</span><span class="token number">1</span> <span class="token comment"># read/write target 이 되는 redis server</span>
  <span class="token key atrule">tokens</span><span class="token punctuation">:</span> <span class="token string">'0'</span>
  <span class="token key atrule">data_store</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">pem_key_file</span><span class="token punctuation">:</span> /etc/dynomitedb/dynomite.pem
  <span class="token key atrule">secure_server_option</span><span class="token punctuation">:</span> none
  <span class="token key atrule">read_consistency</span><span class="token punctuation">:</span> DC_QUORUM <span class="token comment"># DC_ONE / DC_QUORUM</span>
  <span class="token key atrule">write_consistency</span><span class="token punctuation">:</span> DC_QUORUM
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="envoy-redis-proxy"><a href="#envoy-redis-proxy" class="header-anchor">#</a> Envoy Redis Proxy</h3> <h4 id="introduction-2"><a href="#introduction-2" class="header-anchor">#</a> Introduction</h4> <p>Envoy는 대규모의 현대적인 서비스 지향 아키텍처를 위해 설계된 L7 Proxy 및 Communication bus 이며, Service Mesh 를 구성하는 데에 활용. 많은 기능 중에서 Redis Proxy 의 request mirroring 을 통한 replication 및 고 가용성 확보 방안을 검토.</p> <p>Envoy는 Redis Proxy 로 동작하여 cluster의 인스턴스간에 명령을 분할 할 수 있다. 이 모드에서 Envoy의 목표는 일관성보다는 가용성과 파티션 허용성을 유지하는 것이다. 또한, 액세스 패턴, 제거 또는 격리 요구 사항에 따라 서로 다른 워크로드에서 서로 다른 upstream cluster 로 routing 명령을 지원함.</p> <blockquote><p>Envoy Redis Proxy Overview 참조<br> <a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/redis.html" target="_blank" rel="noopener noreferrer">https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/redis.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h4 id="architecture-overview-2"><a href="#architecture-overview-2" class="header-anchor">#</a> Architecture Overview</h4> <ul><li><p>Request Flow</p> <ul><li>Envoy Redis Proxy 에서 내부 구조는 크게 Listener / Cluster 로 구분할 수 있음.</li> <li>Listener 에서 Request 를 요청 받기 위한 socket address 를 정의하며, 이를 통해 request 를 수신</li> <li>Listner 내부에 filter 를 정의하여, request 의 routing policy 를 설정</li> <li>위의 routing target 은, Envoy 에서 정의한 clusters 중의 하나로 혹은 그 이상으로 설정 가능</li> <li>Redis Proxy 의 경우, cluster 에 target 이 되는 redis server / cluster 를 정의할 수 있음</li></ul></li> <li><p>HTTP router filter 예시<br> <img src="https://www.envoyproxy.io/docs/envoy/latest/_images/lor-architecture.svg" width="800px" height="450px" title="envoy-arch" alt="envoy-arch"></p></li></ul> <blockquote><p>Envoy Life of Request 참조<br> <a href="https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#" target="_blank" rel="noopener noreferrer">https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h4 id="구성-architecture-2"><a href="#구성-architecture-2" class="header-anchor">#</a> 구성 Architecture</h4> <p>Kubernetes 환경에서 제공되는 Redis Standalone 서비스의 고 가용성 확보를 위한 구성 방안<br>
: Envoy Redis Proxy Sidecar 를 통한 request mirroring</p> <ul><li>Redis Standalone + Envoy Sidecar Deployment
<ul><li>각 Redis Deployment 를 component로 묶어서 공통으로 request 를 처리할 수 있는 service 생성</li> <li>Client 는 common service 에 request.</li> <li>common service 에서 각 envoy pod 에 Load Balancing.</li> <li>envoy pod 에 write 작업 요청 시, route 설정된 redis 에 write.</li> <li>envoy 의 cluster 에 정의된 다른 redis 에 request mirroring 하여 wirte.<br>
| <u><em>envoy 에서 redis 에 write 및 request mirroring 시, 각 redis 별로 생성된 k8s service 를 통하여 호출 (아래 그림에서는 각 service 생략)</em></u></li></ul></li></ul> <img src="https://www.plantuml.com/plantuml/svg/ZP9FIyGm4CNl-HH3Jteej1NyTv0LSH4MFDYZUCWsiqknJIJ9xh98lxlJILABKF0scTzxUUcZA-UbzOU-4zbJrwBs6KW73Oz26uMGFMzgNkAdWsy1yDwOlZSwTsYFROCVRA3LU2OSJ6-eMWSlZ-nKMpO2M6oyrFkE17OKv4LHHGLDKGIWf9TRwPAA5JoHA4ekK1_D-PApfKtxOIcbd5BA_wIK2odbb3A88TMpZlNiGZtE6olt15xNDTJXm0AzSsGArKB-yDjP6Y1NvgH7mbdtNzTNjyK2hH9bwSJI-qTwSnTezPTMSqhU6PaSixj46k8z_279CD-jK2lwatu0" alt="uml diagram"> <h4 id="구성-내역-2"><a href="#구성-내역-2" class="header-anchor">#</a> 구성 내역</h4> <ul><li>Redis Standalone + Envoy Sidecar Deployment</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">...</span>

    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token comment"># Redis Standalone</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>envoy<span class="token punctuation">-</span><span class="token number">001</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>latest
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">6379</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span> 
          <span class="token punctuation">-</span> redis<span class="token punctuation">-</span>server
          <span class="token punctuation">-</span> <span class="token string">&quot;/redis-master/redis.conf&quot;</span>
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 500m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 300m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> shared<span class="token punctuation">-</span>storage
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>config
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /redis<span class="token punctuation">-</span>master
      <span class="token comment"># Envoy Sidecar</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy
        <span class="token key atrule">image</span><span class="token punctuation">:</span> envoyproxy/envoy<span class="token punctuation">-</span>dev<span class="token punctuation">:</span>latest
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token comment"># Envoy Proxy</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">6380</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy
          <span class="token comment"># Envoy Admin</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8001</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> admin
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 500m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 300m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy<span class="token punctuation">-</span>config
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/envoy

<span class="token punctuation">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><ul><li>Envoy Listener/Filter 및 Cluster 구성 내역 (envoy.yaml)</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>
<span class="token comment"># Admin 설정</span>
<span class="token key atrule">admin</span><span class="token punctuation">:</span>
  <span class="token key atrule">access_log_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/dev/null&quot;</span>
  <span class="token key atrule">address</span><span class="token punctuation">:</span>
    <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
      <span class="token key atrule">address</span><span class="token punctuation">:</span> 0.0.0.0
      <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">8001</span>
<span class="token key atrule">static_resources</span><span class="token punctuation">:</span>
  <span class="token comment"># Listener Port address 설정</span>
  <span class="token key atrule">listeners</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis_listener
    <span class="token key atrule">address</span><span class="token punctuation">:</span>
      <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
        <span class="token key atrule">address</span><span class="token punctuation">:</span> 0.0.0.0
        <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">6380</span>
    <span class="token key atrule">filter_chains</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">filters</span><span class="token punctuation">:</span>
      <span class="token comment"># Proxy Filter type 정의</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.filters.network.redis_proxy
        <span class="token key atrule">typed_config</span><span class="token punctuation">:</span>
          <span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation">:</span> type.googleapis.com/envoy.extensions.filters.network.redis_proxy.v3.RedisProxy
          <span class="token key atrule">prefix_routes</span><span class="token punctuation">:</span>
            <span class="token comment"># route target cluster 정의</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>envoy<span class="token punctuation">-</span><span class="token number">001</span>
              <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
              <span class="token comment"># request mirroring target cluster 정의</span>
              <span class="token key atrule">request_mirror_policy</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>envoy<span class="token punctuation">-</span><span class="token number">002</span>
                  <span class="token key atrule">exclude_read_commands</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">stat_prefix</span><span class="token punctuation">:</span> egress_redis
          <span class="token key atrule">settings</span><span class="token punctuation">:</span>
            <span class="token key atrule">op_timeout</span><span class="token punctuation">:</span> 5s
            <span class="token key atrule">enable_redirection</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># target cluster 에 redis standalone service list 정의</span>
  <span class="token key atrule">clusters</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>envoy<span class="token punctuation">-</span><span class="token number">001</span>
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s
    <span class="token key atrule">type</span><span class="token punctuation">:</span> STRICT_DNS
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> MAGLEV
    <span class="token key atrule">load_assignment</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster_name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>envoy<span class="token punctuation">-</span><span class="token number">001</span>
      <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">lb_endpoints</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
            <span class="token key atrule">address</span><span class="token punctuation">:</span>
              <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
                <span class="token key atrule">address</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>envoy<span class="token punctuation">-</span><span class="token number">001</span>
                <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">6379</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>envoy<span class="token punctuation">-</span><span class="token number">002</span>
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s
    <span class="token key atrule">type</span><span class="token punctuation">:</span> STRICT_DNS
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> MAGLEV
    <span class="token key atrule">load_assignment</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster_name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>envoy<span class="token punctuation">-</span><span class="token number">002</span>
      <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">lb_endpoints</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
            <span class="token key atrule">address</span><span class="token punctuation">:</span>
              <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
                <span class="token key atrule">address</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>envoy<span class="token punctuation">-</span><span class="token number">002</span>
                <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">6379</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h3 id="unsupported-command"><a href="#unsupported-command" class="header-anchor">#</a> Unsupported Command</h3> <p>Proxy 를 통한 Redis 접속 시, 서버에 안정적으로 해시 할 수 있는 command 만 지원하며, AUTH 및 PING은 예외. 지원되는 다른 모든 command 에는 key 가 parameter 로 전달되어야 하며, 지원되는 command 실패 시나리오를 제외하고는 원래 Redis 명령과 기능적으로 동일.</p> <p>예를 들면, hello / info / keys 와 같은 command 는 지원되지 않으며, flushall 과 같은 parameter 없이 동작하는 delete All command 를 지원하지 않음.<br>
| <u><em>Dynomite 의 경우에는 keys command 는 지원됨</em></u></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>~ redis-cli -p 6380
127.0.0.1:6380&gt; keys *
(error) unsupported command 'keys'
127.0.0.1:6380&gt; hello 3
(error) unsupported command 'hello'
127.0.0.1:6380&gt; info dir
unsupported command 'info'
127.0.0.1:6380&gt; flushall
(error) invalid request

...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>Envoy Redis Proxy Supported Command 참조<br> <a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/redis.html#supported-commands" target="_blank" rel="noopener noreferrer">https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/redis.html#supported-commands<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="proxy-request-mirroring"><a href="#proxy-request-mirroring" class="header-anchor">#</a> Proxy Request Mirroring</h2> <p>Envoy Redis Proxy 의 경우, datacenter replication 을 통한 consistency 유지 보다는, partioning / sharding 등의 data 분산 처리에 더 적합할 것으로 보임</p> <h3 id="redis-read-replicas"><a href="#redis-read-replicas" class="header-anchor">#</a> Redis Read Replicas</h3> <ul><li>prefix 를 통한 data 분산 및 read replicas 제공 방안</li></ul> <img src="https://www.plantuml.com/plantuml/svg/VLAxRiCm3Dpr5OHt0t573q7wy1HqISQYWnAnXL1BCYGrQL3atqjJafq4RJVoxdGa3rg5A7tyDBsexfNHjW8PG8wLg1vxZJOoikTIMASGgcwzPH0_0dmBW9VE7jpfbQ6n8aZ9A7Soa7Y3IWTubY6YvrT-10pt94oEIRJ1eTTx6R8iDJpXql091zhOq3fXzbiixcvadHbwTqAy4ZKaEejpkUCXtx5BKq9qNhuJiKq5aoE8qxf_Iz86__4D3KuvGhsSxckfaafmv50hTxH4Semj7BsEABX9J-RaCfZr9OCM1ezl-gjLSqY_Ivj9YYKeSU4FzTNXnJ-xp1SNjnkY4IkqYdxL3m00" alt="uml diagram"> <ul><li>구성 내역</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">...</span>

<span class="token key atrule">static_resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">listeners</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis_listener
    <span class="token key atrule">address</span><span class="token punctuation">:</span>
      <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
        <span class="token key atrule">address</span><span class="token punctuation">:</span> 0.0.0.0
        <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">6380</span>
    <span class="token key atrule">filter_chains</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">filters</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.filters.network.redis_proxy
        <span class="token key atrule">typed_config</span><span class="token punctuation">:</span>
          <span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation">:</span> type.googleapis.com/envoy.extensions.filters.network.redis_proxy.v3.RedisProxy
          <span class="token key atrule">prefix_routes</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
            <span class="token comment"># prefix 별 request mirroring</span>
            <span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>master
              <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token string">&quot;departments&quot;</span>
              <span class="token key atrule">request_mirror_policy</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>departments
                  <span class="token key atrule">exclude_read_commands</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>master
              <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token string">&quot;employees&quot;</span>
              <span class="token key atrule">request_mirror_policy</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>employees
                  <span class="token key atrule">exclude_read_commands</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">stat_prefix</span><span class="token punctuation">:</span> egress_redis
          <span class="token key atrule">settings</span><span class="token punctuation">:</span>
            <span class="token key atrule">op_timeout</span><span class="token punctuation">:</span> 5s
            <span class="token key atrule">enable_redirection</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">clusters</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>master
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s
    <span class="token key atrule">type</span><span class="token punctuation">:</span> STRICT_DNS
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> MAGLEV
    <span class="token key atrule">load_assignment</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster_name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>master
      <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">lb_endpoints</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
            <span class="token key atrule">address</span><span class="token punctuation">:</span>
              <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
                <span class="token key atrule">address</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>master
                <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">6379</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>departments
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s
    <span class="token key atrule">type</span><span class="token punctuation">:</span> STRICT_DNS
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> MAGLEV
    <span class="token key atrule">load_assignment</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster_name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>departments
      <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">lb_endpoints</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
            <span class="token key atrule">address</span><span class="token punctuation">:</span>
              <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
                <span class="token key atrule">address</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>departments
                <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">6379</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>employees
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s
    <span class="token key atrule">type</span><span class="token punctuation">:</span> STRICT_DNS
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> MAGLEV
    <span class="token key atrule">load_assignment</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster_name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>employees
      <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">lb_endpoints</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
            <span class="token key atrule">address</span><span class="token punctuation">:</span>
              <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
                <span class="token key atrule">address</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>employees
                <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">6379</span>

<span class="token punctuation">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><h3 id="기타"><a href="#기타" class="header-anchor">#</a> 기타</h3> <p>MongoDB / Postgres 등의 Proxy 또한 지원한다.</p> <h2 id="성능-측정"><a href="#성능-측정" class="header-anchor">#</a> 성능 측정</h2> <p>Redis 의 기본 성능과 Proxy 를 통한 성능 비교.</p> <h3 id="redis-benchmark"><a href="#redis-benchmark" class="header-anchor">#</a> Redis Benchmark</h3> <p>Redis 자체적으로 제공하는 RedisCluster 및 Sentinel 장비에 대한 성능 측정 도구</p> <h4 id="environment"><a href="#environment" class="header-anchor">#</a> Environment</h4> <ul><li>AOF persistence 에서 측정</li> <li>Storage 의 경우, ReadWriteMany 가 가능  NFS 기반 Storage Service 를 활용</li></ul> <table><thead><tr><th>Category</th> <th>Value</th></tr></thead> <tbody><tr><td>Redis CPU</td> <td>0.3 / 0.5</td></tr> <tr><td>Reids Memory</td> <td>0.5Gi</td></tr> <tr><td>Storage</td> <td>Amazon EBS (General Purpose)</td></tr> <tr><td>Redis Persistence</td> <td>AOF (everysec)</td></tr></tbody></table> <h4 id="result"><a href="#result" class="header-anchor">#</a> Result</h4> <p>Proxy 를 통하여 benchmark test 수행한 결과, 기존 성능에 비해 50% 정도 감소된 성능으로 측정됨.<br>
대체적으로 10000 tps 이상 처리가 가능한 것으로 보여, Application 에서 활용할 때에는 2000~3000 tps 정도를 처리하는 데에는 문제가 없을 것으로 보임.</p> <ul><li>Redis Benchmark</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>redis $ redis-benchmark -q -t get,set,lpop,lpush
SET: 20815.99 requests per second, p50=0.311 msec
GET: 20370.75 requests per second, p50=0.327 msec
LPUSH: 21781.75 requests per second, p50=0.303 msec
LPOP: 21810.25 requests per second, p50=0.295 msec
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>Dynomite Benchmark</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>dynomite $ redis-benchmark -p 8102 -q -t get,set,lpop,lpush
SET: 14830.19 requests per second, p50=0.887 msec
GET: 19623.23 requests per second, p50=0.583 msec
LPUSH: 14898.69 requests per second, p50=0.879 msec
LPOP: 14909.80 requests per second, p50=0.879 msec
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>Envoy Redis Proxy Benchmark</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>envoy $ redis-benchmark -p 6380 -q -t get,set,lpop,lpush
SET: 9100.01 requests per second, p50=0.767 msec
GET: 11132.14 requests per second, p50=0.727 msec
LPUSH: 9426.85 requests per second, p50=0.823 msec
LPOP: 9912.77 requests per second, p50=0.839 msec
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="application-부하-test"><a href="#application-부하-test" class="header-anchor">#</a> Application 부하 Test</h3> <h4 id="environment-2"><a href="#environment-2" class="header-anchor">#</a> Environment</h4> <ul><li>TPS 1000 이상의 성능이 나오는 적정 환경에서 수행</li> <li>nGrinder Agent 2ea</li></ul> <table><thead><tr><th>Category</th> <th>Value</th></tr></thead> <tbody><tr><td>Spring CPU</td> <td>0.5 / 2</td></tr> <tr><td>Spring Memory</td> <td>2048Mi</td></tr> <tr><td>Redis CPU</td> <td>0.3 / 0.5</td></tr> <tr><td>Reids Memory</td> <td>0.5Gi</td></tr> <tr><td>Storage</td> <td>Amazon EBS (General Purpose)</td></tr> <tr><td>Redis Persistence</td> <td>AOF (everysec)</td></tr> <tr><td>Ramp-Up</td> <td>Enable</td></tr></tbody></table> <h4 id="result-2"><a href="#result-2" class="header-anchor">#</a> Result</h4> <p>동일한 부하 상황에서, 1000tps 정도의 처리는 Sidecar Proxy 를 통하여 정상적으로 처리 가능할 것으로 보임.</p> <p>Dynomite vs Envoy 를 비교했을 때, data sync 결과는 모두 특이사항이 없으며, 테스트 결과에서는 dynomite 의 replication 방식이 조금 우수한 것으로 보이나, 크게 차이는 없을 것으로 예상됨.</p> <ul><li>Redis Write Only</li></ul> <table><thead><tr><th>vUser</th> <th>Threshold</th> <th>TPS</th> <th>Count</th> <th>Sync</th> <th>Comment</th></tr></thead> <tbody><tr><td>1000</td> <td>2min</td> <td>1063</td> <td>115000</td> <td>-</td> <td></td></tr> <tr><td>2000</td> <td>2min</td> <td>1089</td> <td>117000</td> <td>-</td> <td></td></tr> <tr><td>3000</td> <td>2min</td> <td>784</td> <td>81000</td> <td>-</td> <td>Application 성능 저하 구간 (cpu 최대)</td></tr></tbody></table> <ul><li>Dynomite Sidecar Replication</li></ul> <table><thead><tr><th>vUser</th> <th>Threshold</th> <th>TPS</th> <th>Count</th> <th>Sync</th> <th>Comment</th></tr></thead> <tbody><tr><td>1000</td> <td>2min</td> <td>1038</td> <td>114000</td> <td>100%</td> <td></td></tr> <tr><td>2000</td> <td>2min</td> <td>865</td> <td>92000</td> <td>100%</td> <td></td></tr> <tr><td>3000</td> <td>2min</td> <td>1138</td> <td>120000</td> <td>100%</td> <td>Application 성능 저하 구간 (cpu 최대)</td></tr></tbody></table> <ul><li>Envoy Proxy Request Mirroring</li></ul> <table><thead><tr><th>vUser</th> <th>Threshold</th> <th>TPS</th> <th>Count</th> <th>Sync</th> <th>Comment</th></tr></thead> <tbody><tr><td>1000</td> <td>2min</td> <td>1054</td> <td>114000</td> <td>100%</td> <td></td></tr> <tr><td>2000</td> <td>2min</td> <td>650</td> <td>69000</td> <td>100%</td> <td></td></tr> <tr><td>3000</td> <td>2min</td> <td>677</td> <td>71000</td> <td>100%</td> <td>Application 성능 저하 구간 (cpu 최대)</td></tr></tbody></table></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">8/5/2022, 7:03:57 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blogs/003_refarch/perftest.html" class="prev">
            Redis 성능 측정
          </a></span> <span class="next"><a href="/blogs/003_refarch/camel.html">
            Apache Camel and EIP
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/blogs/003_refarch/hatest.html#standalone-sidecar" class="sidebar-link reco-side-standalone-sidecar" data-v-cb1513f6>Standalone + Sidecar</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/003_refarch/hatest.html#netflix-dynomite" class="sidebar-link reco-side-netflix-dynomite" data-v-cb1513f6>Netflix Dynomite</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/003_refarch/hatest.html#envoy-redis-proxy" class="sidebar-link reco-side-envoy-redis-proxy" data-v-cb1513f6>Envoy Redis Proxy</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/003_refarch/hatest.html#unsupported-command" class="sidebar-link reco-side-unsupported-command" data-v-cb1513f6>Unsupported Command</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/003_refarch/hatest.html#proxy-request-mirroring" class="sidebar-link reco-side-proxy-request-mirroring" data-v-cb1513f6>Proxy Request Mirroring</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/003_refarch/hatest.html#redis-read-replicas" class="sidebar-link reco-side-redis-read-replicas" data-v-cb1513f6>Redis Read Replicas</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/003_refarch/hatest.html#기타" class="sidebar-link reco-side-기타" data-v-cb1513f6>기타</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/003_refarch/hatest.html#성능-측정" class="sidebar-link reco-side-성능-측정" data-v-cb1513f6>성능 측정</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/003_refarch/hatest.html#redis-benchmark" class="sidebar-link reco-side-redis-benchmark" data-v-cb1513f6>Redis Benchmark</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/003_refarch/hatest.html#application-부하-test" class="sidebar-link reco-side-application-부하-test" data-v-cb1513f6>Application 부하 Test</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.fc570ef8.js" defer></script><script src="/assets/js/4.f98f6a05.js" defer></script><script src="/assets/js/1.89d62b8c.js" defer></script><script src="/assets/js/51.745f73c5.js" defer></script>
  </body>
</html>
